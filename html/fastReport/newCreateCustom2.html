<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" href="../../css/iuapmobile.um.css">
	<link rel="stylesheet" href="../../css/fonts/iconfont.css">
	<script src="../../js/font.js"></script>
	<style>
		input::-webkit-input-placeholder {
			color: #DEDEDE;
			font-size: 0.28rem;
		}

		.topheader {
			position: relative;
			height: 180px;
			background-image: url("img/cardBgc.png");
			background-repeat: no-repeat;
			background-size: 100% 100%;
		}

		.topheader img {
			margin-top: 0.8rem;
			width: 2.8rem;
			height: 1.8rem;
		}

	 
		div.item {
			line-height: 44px;
			background: #ffffff;
			border-bottom: 1px solid #f7f7f7;
			font-size: 0.28rem;
			height:44px;

		}

		div.item span {
			color: #333;
		}

		div.item span i {
			color: #dbdbdb;
		}

		 

		.item .first {

			color: #333;
		}

		.item .second {
			color: #9e9e9e;
		}
		.um-footer{
			min-height:0px;
		}
		.item input{
			border: none;
			height: .5rem;
			width: 2.92rem;
			text-align: right;
			line-height: .5rem;
			outline: none;
			margin-top: .2rem;
			font-size: 0.28rem;
		}
	</style>
</head>

<body>
	<div class="um-win" id="app" v-cloak>
		<!-- <div class="topheader tc um-header-light" @click="cardIdentify">
			<img v-bind:src="cardUrl" v-show="cardShow" alt="" />
		</div> -->
		<div class="um-content">
			<div class="item">
					<p class="pl10 pr10 tr">
						<span class="fl">姓名</span>
						<span class="">
							<span class="first">{{message.cstNpSocialRl.rlNm}} </span>
						</span>
					</p>
			</div>
			<div class="item">
					<p class="pl10 pr10 tr">
						<span class="fl">身份证</span>
						<span class="">
							<span class="first">{{message.cstNpSocialRl.certNo}} </span>
						</span>
					</p>
			</div>
			<div class="item">
					<p class="pl10 pr10 tr">
						<span class="fl">性别</span>
						<span class="">
							<span class="first">{{SEXCOM}} </span>
						</span>
					</p>
			</div>
		<form action="">
			<div class="item um-box pl10 pr10"  >
					 	<span class="um-bf1">手机号</span><input class="um-bf3"  placeholder="请输入您的手机号码"  v-model="message.cstNpSocialRl.mp" type="text" />   
			</div>
			<div class="item um-box pl10 pr10"  >
					 	<span class="um-bf1">户口所在地</span><input class="um-bf3" placeholder="请输入您的户口所在地" v-model="message.cstNpSocialRl.idAddr"   type="text" />   
			</div>
			<div class="item um-box pl10 pr10"  >
					 	<span class="um-bf1">工作单位名称</span><input class="um-bf3" placeholder="请输入您的工作单位" v-model="message.cstNpSocialRl.workPlc"   type="text" />   
			</div>
			<div class="item um-box pl10 pr10"  >
					<span class="um-bf1">税后年收入（万元）</span><input class="um-bf3" placeholder="请输入您的税后年收入" v-model="message.cstNpSocialRl.afterTaxYearIn"   type="text" />   
	   </div>
		</form>
		</div>
	 
	</div>
	<script src="../../js/summer.js"></script>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/vue.js"></script>
	<script src="../../js/common.js"></script>
	<script src="../../js/Frameworks/iuapmobile.frameworks.ui.js"></script>
	<script>
		var newCreateCustom = new Vue({
			el: '#app',
			data:function() {
				return {
					cardShow: false,
					cardUrl: "",
					pickerVisible: "",
					personMes:'',
					message: {
						cstNpSocialRl:{
							rlNm:'',
							certNo:'',
							certTypCd:'1',
							genderCd:'',
							idAddr:'',
							workPlc:'',
							mp:'',
							id:''//配偶id，修改需要带上
						}
					},
					sourceFrom:'',
				}
			},
			computed: {
				 SEXCOM: function () {
					if (this.message.cstNpSocialRl && this.message.cstNpSocialRl.certNo.length == "18") {
						var psidno = this.message.cstNpSocialRl.certNo;
						if (parseInt(psidno.substring(16, 17)) % 2 == 0) {
							return "女"
						} else {
							return "男"
						};
					}
				}
			 
			},
			methods: {
				getData:function(projectId, clintId) {
					var self = this;
					ajaxRequest({
						type: 'post',
						url: 'appservice/customer/custDetail',
						param: {
							"CLIENT_ID": clintId,
						}
					}, function(res) {
						summer.hideProgress();
						if (res.data.flag == 1) {
							//self.baseMessageData=res.data.datas;
							//console.log(self.baseMessageData);
						}
					}, function(err) {
						alert(err);
						console.log(err);
						summer.hideProgress();
					});
				},
			 
				// handleClick: function() {
				// 	this.$toast('Hello world!')
				// },
				// cardIdentify: function() {
				// 	var _self = this;
				// 	PersonScan.scan({}, function(args) {
				// 		console.log(args);
				// 		_self.message.cstNpSocialRl.rlNm = args.name;
				// 		_self.message.cstNpSocialRl.certNo = args.id;
				// 		_self.message.cstNpSocialRl.SPOUST_SEX_NM = args.sex;
				// 		_self.message.cstNpSocialRl.SPOUST_BIRTHDAY = args.birth_date;
				// 		_self.message.cstNpSocialRl.SPOUST_HOUSR_RE_ADDRESS = args.address;
				// 		CommonUtil.watermark({
				// 			srcImage: args.imagePath,
				// 			targetImage: args.imagePath,
				// 			name: args.name,
				// 			callback: function(arg) {
				// 				if (!arg.target) {
				// 					_self.cardUrl = arg.watermarkFile;
				// 				} else {
				// 					_self.cardUrl = arg.target;
				// 				}
				// 				_self.cardShow = true;
				// 			}
				// 		});
				// 	}, function(args) {
				// 		console.log(args);
				// 	});
				// },
				// successCallBack: function(args) {
				// 	console.log(args);
				// },
				// onValuesChange1: function(picker, values) {
				// 	this.pickerSex = values[0];
				// },
				// surePickerSex: function(param) {
				// 	this.pickerSexStatus = !this.pickerSexStatus;
				// 	if (param == 'confirm') {
				// 		this.message.cstNpSocialRl.SPOUST_SEX_NM = this.pickerSex;
				// 	}
				// },

				// sureDateConfirm: function() {
				// 	this.pickerDateStatus = !this.pickerDateStatus;
				// 	this.$refs.picker.open();
				// },
				// handleConfirm: function(pickerValue) {
				// 	this.pickerValue = pickerValue;
				// 	this.message.cstNpSocialRl.SPOUST_BIRTHDAY = getFormatDate(pickerValue)
				// 	function getFormatDate(date) {
				// 		var date = new Date(date),
				// 			seperator1 = "-";
				// 		var year = date.getFullYear(),
				// 			month = date.getMonth() + 1,
				// 			strDate = date.getDate();
				// 		if (month >= 1 && month <= 9) {
				// 			month = "0" + month;
				// 		}
				// 		if (strDate >= 0 && strDate <= 9) {
				// 			strDate = "0" + strDate;
				// 		}
				// 		return year +'-' +month +'-'+ strDate;
				// 	}

				// },
				messageTest: function() {
					var phoneCard = /^[1][3,4,5,7,8,9][0-9]{9}$/;
				   if (this.message.cstNpSocialRl.idAddr == "") {
						summer.toast({
							msg: "户口所在地不能为空"
						});
						return false;
					} else if (this.message.cstNpSocialRl.workPlc == "") {
						summer.toast({
							msg: "工作单位不能为空"
						});
						return false;
					} else if (this.message.cstNpSocialRl.mp == "") {
						summer.toast({
							msg: "手机号不能为空"
						});
						return false;
					} else if (!phoneCard.test(this.message.cstNpSocialRl.mp)) {
						summer.toast({
							msg: "手机号格式不正确"
						});
						return false;
					}
					return true;
				},
				savePerson: function() {
					var self=this;
					if (!this.messageTest()) {
						return;
					};
					self.personMes.cstNpSocialRl=self.message.cstNpSocialRl;
				 
					var finanlInput=JSON.parse(JSON.stringify(self.personMes));
					ajaxRequest({
						type: 'post',
						url: 'appservice/customer/cstNpBscInfo/save.do',
						param:finanlInput
					}, function(res) {
						summer.hideProgress();
						if (res.data.flag == 1) {
							//self.baseMessageData=res.data.datas;
							//console.log(self.baseMessageData);
							summer.toast({msg:"保存成功"});
							//var clint_Id=res.data.datas.id;
							var clint_Id = res.data.datas.cstId;
								//self.clintId=clint_Id;
								//self.message.id=res.data.datas.npId;//保存详情id
							//var clint_Id=self.res.data.datas.cstId
							if (self.sourceFrom=="newCreateCustom_verify2") {
								summer.openWin({
									id : 'setProject',
									url : 'html/fastReport/setProject.html',
									create : false,
									type : 'actionBar',
									pageParam:{
										source:"customer",
										customId:clint_Id
									},
									actionBar : {
										title : "快捷报单",
										titleColor : "#ffffff", //注意必须是6位数的颜色值。（3位数颜色值会不正常）
										backgroundColor : "#039be5",
										leftItem : {
											image : "img/back.png",
											method : "", //返回按钮自定义事件
											text : "返回",
											textColor : "#ffffff" //返回文字颜色，注意必须是6位数的颜色值。（3位数颜色值会不正常）
										},
										rightItems : [{
											type : "text",
											text : "下一步",
											textColor : "#ffffff", //文字颜色，注意必须是6位数的颜色值。（3位数颜色值会不正常）
											method : "nextStopInput()" //在打开的window中自定义事件
										}]
									}
								});
							} else if(self.sourceFrom=="newCustom"){
								summer.closeToWin({id:"newCustom"});
							} else if(self.sourceFrom=="setProject") {  
									summer.closeToWin({id:"setProject"});
							}
						}else if(res.data.flag==0){
							if(res.data.code=="E02003"){
								summer.toast({msg:"客户证件号重复,请重新录入"});
								return
							}
						}
					}, function(err) {
						alert(err);
						console.log(err);
						summer.hideProgress();
					});
				},
				// openPicker: function() {
				// 	this.$refs.picker.open();
				// }
			}
		})

		function saveAllPerMessage() {
			newCreateCustom.savePerson();
		}
		summerready = function() {
			var personMessage = summer.pageParam.personMessage;
			var sponseBase=summer.pageParam.sponseBase;
			var sourceFrom=summer.pageParam.sourceFrom;
			if(sourceFrom=="newCreateCustom_verify2"){
				if(sponseBase){
					newCreateCustom.message.cstNpSocialRl.rlNm=sponseBase.cstNm;
					newCreateCustom.message.cstNpSocialRl.certNo=sponseBase.certNo;
					newCreateCustom.message.cstNpSocialRl.genderCd=sponseBase.genderNm=="男"?"1":"2";
				}
			}else{
				if(personMessage&&personMessage.cstNpSocialRl){
					newCreateCustom.message.cstNpSocialRl.rlNm=personMessage.cstNpSocialRl.rlNm
					newCreateCustom.message.cstNpSocialRl.certNo=personMessage.cstNpSocialRl.certNo
					newCreateCustom.message.cstNpSocialRl.genderCd=personMessage.cstNpSocialRl.genderCd
					newCreateCustom.message.cstNpSocialRl.idAddr=personMessage.cstNpSocialRl.idAddr
					newCreateCustom.message.cstNpSocialRl.workPlc=personMessage.cstNpSocialRl.workPlc
					newCreateCustom.message.cstNpSocialRl.mp=personMessage.cstNpSocialRl.mp;
					newCreateCustom.message.cstNpSocialRl.id=personMessage.cstNpSocialRl.id
				}
			}
			newCreateCustom.sourceFrom=sourceFrom;
			newCreateCustom.personMes=personMessage;
		}
	</script>
</body>

</html>
