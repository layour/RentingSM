<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" href="../../css/iuapmobile.um.css">
	<link rel="stylesheet" href="../../css/fonts/iconfont.css">
	<link rel="stylesheet" href="../../css/mint.css">
	<script src="../../js/font.js"></script>
	<style>
		input::-webkit-input-placeholder {
			color: #DEDEDE;
			font-size: 0.28rem;
		}

		.topheader {
			position: relative;
			height: 180px;
			background-image: url("img/cardBgc.png");
			background-repeat: no-repeat;
			background-size: 100% 100%;
		}

		.topheader img {
			margin-top: 0.8rem;
			width: 2.8rem;
			height: 1.8rem;
		}

		.mint-field-core {
			text-align: right;
		}

		.mint-cell-wrapper {
			color: #333;
			font-size: 0.28rem;
		}

		.mint-cell {
			min-height: 40px;
			height: 44px;
			color: #333;
			font-size: 0.28rem;
		}

		div.item {
			line-height: 44px;
			background: #ffffff;
			border-bottom: 1px solid #f7f7f7;
			font-size: 0.28rem;
			height:44px;

		}

		div.item span {
			color: #333;
		}

		div.item span i {
			color: #dbdbdb;
		}

		.pickerColor {
			width: 100%;
			z-index: 10;
			background: #ffffff;
		}

		.pickerColor>p {
			line-height: .88rem;
			padding: 0 .56rem;
			color: #039BE5;
			border-top: 1px solid #E0E0E0;
			overflow: hidden;
		}

		.pickerColor>p span {
			color: #34aadc;
		}

		.mint-cell-wrapper {
			background-size: 100% 0px;
			border-bottom: 1px solid #f7f7f7;
		}

		.pickerColor>p span:last-child {
			float: right;
		}
		.pickerColor>p span:first-child {
			float: left;
		}
		.item .first {

			color: #333;
		}

		.item .second {
			color: #9e9e9e;
		}
		.um-footer{
			min-height:0px;
		}
		.item input{
			border: none;
			height: .5rem;
			width: 2.92rem;
			text-align: right;
			line-height: .5rem;
			outline: none;
			margin-top: .2rem;
			font-size: 0.28rem;
		}
	</style>
</head>

<body>
	<div class="um-win" id="app" v-cloak>
		<div class="um-content">
			<!-- <div class="topheader tc um-header-light" @click="cardIdentify">
				<img v-bind:src="cardUrl" v-show="cardShow" alt="" />
			</div> -->
			<div   class="item">
				<p class="pl10 pr10 tr">
					<span class="fl">担保人类型</span>
					<span class=""><span   class="first"> 个人</span>   </span>
				</p>
			</div>
			<mt-field label="姓名" placeholder="请输入您的真实姓名" v-model="message.NAME"> </mt-field>
			<div @click="surePickerCusRelation" class="item">
				<p class="pl10 pr10 tr">
					<span class="fl">与客户关系</span>
					<span class=""><span v-if='message.gxNm' class="first">{{message.gxNm}}</span><span v-else class="second">请选择</span> <i class="icon iconfont icon-enter"></i></span>
				</p>
			</div>
			<div @click="surePickerCardType" class="item">
				<p class="pl10 pr10 tr">
					<span class="fl">证件类型</span>
					<span class=""><span v-if='message.certTypNm' class="first">{{message.certTypNm}}</span><span v-else class="second">请选择</span> <i class="icon iconfont icon-enter"></i></span>
				</p>
			</div>
			<mt-field label="证件号码" placeholder="请输入您的证件号码" v-model="message.ID_CARD_NO"></mt-field>
			<div  class="item" >
				<p class="pl10 pr10 tr" >
					<span class="fl">性别</span>
					 <span class=""> <span  class="first" >{{SEXCOM}} </span> </span>
				</p>
			</div>
			<div  class="item">
				<p class="pl10 pr10 tr" >
					<span class="fl">年龄</span>
					 <span class=""> <span  class="first" >{{AGECOM}} </span> </span>
				</p>
			</div>
			<mt-field label="家庭住址" placeholder="请输入您的住址" v-model="message.HOUSE_ADDRESS"></mt-field>
			<mt-field label="单位名称" placeholder="请输入您的单位名称" v-model="message.WORK_NAME"></mt-field>
			<mt-field label="手机号" placeholder="请输入您的手机号码" v-model="message.TEL_PHONE"></mt-field>
			<div @click="surePickerMarrige" class="item">
				<p class="pl10 pr10  um-box">
					<span class="um-bf1">婚姻状况</span> <span class="um-bf1 tr"><span v-if='message.marStsNm' class="first">{{message.marStsNm}}</span><span v-else class="second">请选择</span> <i class="icon iconfont icon-enter"></i></span>
				</p>
			</div>
			<div @click="surePickerSoureIncome" class="item" >
					<p class="pl10 pr10  um-box">
						<span class="um-bf1">主要收入来源</span>
						<span class="um-bf1 tr">
							<span v-if='message.majorInTypCdNm' class="first">{{message.majorInTypCdNm}}</span>
							<span v-else class="second">请选择</span>
							<i class="icon iconfont icon-enter"></i>
						</span>
					</p>
			</div>
			<!-- <mt-field label="税后年收入(万元)" type="number" placeholder="请输入您的税后年收入":attr="{ max: 999 }"	 v-model="message.afterTaxYearIn"></mt-field> -->
			<div class="item um-box pl10 pr10"  >
				 <span class="um-bf1">税后年收入(万元)</span><input placeholder="请输入您的税后年收入"  v-model="message.afterTaxYearIn" type="number"    oninput="if(value.length>3)value=value.slice(0,3)">   
		   </div>
		</div>
		<div class="um-footer">
			<mt-popup v-model="pickerCardTypeStatus" position='bottom' class="pickerColor">
				<mt-picker :slots="slots1" @change="onValuesChange1"></mt-picker>
				<p>
					<span class="" @click="surePickerCardType">取消</span><span class="" @click="surePickerCardType('confirm')">确定</span>
				</p>
			</mt-popup>
			<mt-popup v-model="pickerCusRelationStatus" position='bottom' class="pickerColor">
				<mt-picker :slots="slots2" @change="onValuesChange2"></mt-picker>
				<p>
					<span class="" @click="surePickerCusRelation">取消</span><span class="" @click="surePickerCusRelation('confirm')">确定</span>
				</p>
			</mt-popup>
			<mt-popup v-model="pickerMarrigeStatus" position='bottom' class="pickerColor">
				<mt-picker :slots="slots3" @change="onValuesChange3"></mt-picker>
				<p>
					<span class="" @click="surePickerMarrige">取消</span><span class="" @click="surePickerMarrige('confirm')">确定</span>
				</p>
			</mt-popup>
			<mt-popup v-model="pickerSourceIncomeStatus" position='bottom' class="pickerColor">
					<mt-picker :slots="slots8" @change="onValuesChange8"></mt-picker>
					<p>
						<span class="" @click="surePickerSoureIncome">取消</span>
						<span class="" @click="surePickerSoureIncome('confirm')">确定</span>
					</p>
			</mt-popup>
		</div>
	</div>
	<script src="../../js/summer.js"></script>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../js/vue.js"></script>
	<script src="../../js/mint.js"></script>
	<script src="../../js/common.js"></script>
	<script src="../../js/Frameworks/iuapmobile.frameworks.ui.js"></script>
	<script>
		var newCreateCustom = new Vue({
			el: '#app',
			data:function() {
				return {
					cardShow: false,
					cardUrl: "",
					pickerVisible: "",
					pickerCardTypeStatus: false,
					pickerCusRelationStatus: false,
					pickerMarrigeStatus: false,
					pickerSourceIncomeStatus:false,
					pickerSourceIncome:"",
					pickerCardType: "",
					pickerCusRelationType: "",
					pickerMarrige: "",
					slots1: [{
						flex: 1,
						values: [],
						defaultIndex: 0,
						className: 'slot1',
						textAlign: 'center'
					}],
					slots2: [{
						flex: 1,
						values: [],
						defaultIndex: 0,
						className: 'slot1',
						textAlign: 'center'
					}],
					slots3: [{
						flex: 1,
						values: [],
						defaultIndex: 0,
						className: 'slot1',
						textAlign: 'center'
					}],
					slots8: [{
						flex: 1,
						//values:["工资","股票","投资"],
						values: [],
						defaultIndex: 0,
						className: 'slot1',
						textAlign: 'center'
					}],
					isSelect:false,
					totalData:'',
					id:'',//担保人id,保存时需要
					message: {
						NAME: '',//姓名
						ID_CARD_NO: '',//身份证号
						WORK_NAME:'',
						HOUSE_ADDRESS: '',
						TEL_PHONE: '',
						marStsCd: '',
						marStsNm:'',
						gxNm:'',
						certTypNm:'',
						projectId:'',
						GID:"",
						CLIENT_ID:"",
						TYPE:"",
						afterTaxYearIn:'',//税后年收入 
						majorInTypCdNm:'',
						majorInTypCd:''//主要收入来源
					} 
				}
			},
			computed:{
				 SEXCOM:function () {
					if(this.message.ID_CARD_NO&&this.message.ID_CARD_NO.length=="18") {
						var psidno=this.message.ID_CARD_NO;
					   if(parseInt(psidno.substring(16,17))%2==0){
						   return "女"
					   }else{
						   return "男"
					   };
					}
				},
				AGECOM:function () {
					if(this.message.ID_CARD_NO&&this.message.ID_CARD_NO.length=="18") {
						var date = new Date();
						var year = date.getFullYear(); 
						var birthday_year = parseInt(this.message.ID_CARD_NO.substr(6,4));
						return  year - birthday_year;
					}
				}
			},
			methods: {
				getType:function(projectId){
					var self = this;
					ajaxRequest({
						type: 'post',
						url: 'appservice/project/prjcstbscinfo/initList.do',
						param: {
							"id": "",
						}
					}, function(res) {
						summer.hideProgress();
						var totalData;
						if (res.data.flag == 1) {
							console.log(res.data.datas);
							totalData=res.data.datas
						}else  {
							totalData=res.data;
						}
						self.totalData=totalData;
						totalData.carTypArray.map(function(e,i) {
							self.slots1[0].values.push(e.label);
						})
						totalData.gxArray.map(function(e,i) {
							self.slots2[0].values.push(e.label);
						})
						totalData.marStsArray.map(function(e,i) {
							self.slots3[0].values.push(e.label);
						})
						totalData.majorInArray.map(function(e,i) {
							self.slots8[0].values.push(e.label);
						})
						
					}, function(err) {
						alert(err);
						console.log(err);
						summer.hideProgress();
					});
				},
				handleClick: function() {
					this.$toast('Hello world!')
				},
				cardIdentify: function() {
					var _self = this;
					PersonScan.scan({}, function(args) {
						console.log(args);
						_self.message.NAME = args.name;
						_self.message.ID_CARD_NO = args.id;
						_self.message.SEX_NM = args.sex;
						_self.message.BIRTHDAY = args.birth_date;
						_self.message.HOUSE_ADDRESS = args.address;
						CommonUtil.watermark({
							srcImage: args.imagePath,
							targetImage: args.imagePath,
							name: args.name,
							callback: function(arg) {
								if (!arg.target) {
									_self.cardUrl = arg.watermarkFile;
								} else {
									_self.cardUrl = arg.target;
								}
								_self.cardShow = true;
							}
						});
					}, function(args) {
						console.log(args);
					});
				},
				successCallBack: function(args) {
					console.log(args);
				},
				onValuesChange1: function(picker, values) {
					this.pickerCardType = values[0];
				},
				surePickerCardType: function(param) {
					this.pickerCardTypeStatus = !this.pickerCardTypeStatus;
					if (param == 'confirm') {
						this.message.certTypNm = this.pickerCardType;
					}
				},
				onValuesChange2: function(picker, values) {
					this.pickerCusRelation = values[0];
				},
				surePickerCusRelation: function(param) {
					this.pickerCusRelationStatus = !this.pickerCusRelationStatus;
					if (param == 'confirm') {
						this.message.gxNm = this.pickerCusRelation;
					}
				},
				onValuesChange3: function(picker, values) {
					this.pickerMarrige = values[0];
				},
				surePickerMarrige: function(param) {
					this.pickerMarrigeStatus = !this.pickerMarrigeStatus;
					if (param == 'confirm') {
						this.message.marStsNm=this.pickerMarrige
					}
				},
				onValuesChange8: function (picker, values) {
					this.pickerSourceIncome = values[0];
				},
				surePickerSoureIncome: function (param) {
					this.pickerSourceIncomeStatus = !this.pickerSourceIncomeStatus;
					var self = this;
					if (param == 'confirm') {
						this.message.majorInTypCdNm = this.pickerSourceIncome;
						 this.totalData.majorInArray.map(function(e,i){
						 	if(e.label==self.message.majorInTypCdNm){
						 		self.message.majorInTypCd=self.totalData.majorInArray[i].value;
						 	}
						 });
					}
				},
				messageTest: function() {
					var regCard = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; //身份证校验
					var phoneCard =  /^[1][0-9]{10}$/;
					if (this.message.NAME == "") {
						summer.toast({
							msg: "姓名不能为空"
						});
						return false;
					} else if (this.message.ID_CARD_NO == "" || regCard.test(this.message.ID_CARD_NO) === false) {
						summer.toast({
							msg: "请输入正确的身份证号"
						});
						return false; 
					} else if (this.message.certTypNm == "") {
						summer.toast({
							msg: "请选择证件类型"
						});
						return false;
					} else if (this.message.gxNm == "") {
						summer.toast({
							msg: "与客户关系不能为空"
						});
						return false;
					} else if (this.message.HOUSE_ADDRESS == "") {
						summer.toast({
							msg: "住址不能为空"
						});
						return false;
					}  else if (this.message.WORK_NAME == "") {
						summer.toast({
							msg: "单位名称不能为空"
						});
						return false;
					} else if (this.message.TEL_PHONE == "") {
						summer.toast({
							msg: "手机号不能为空"
						});
						return false;
					} else if (!phoneCard.test(this.message.TEL_PHONE)) {
						summer.toast({
							msg: "手机号格式不正确"
						});
						return false;
					} else if (this.message.marStsNm == "") {
						summer.toast({
							msg: "请选择婚姻状况"
						});
						return false;
					} else if (this.message.majorInTypCdNm == "") {
						summer.toast({
							msg: "主要收入来源不能为空"
						});
						return false;
					} else if (this.message.afterTaxYearIn == "") {
						summer.toast({
							msg: "税后年收入不能为空"
						});
						return false;
					}
					return true;
				},
				complete: function() {
					var self=this;
					if (!this.messageTest()) {
						return;
					};
					var paramData;
					if(self.isSelect){
						paramData={
							wrtNm: self.message.NAME,
							certNo:  self.message.ID_CARD_NO,
							mp1: self.message.TEL_PHONE,
							homeAddr: self.message.HOUSE_ADDRESS,
							workAddr: self.message.WORK_NAME,
							genderCd:  self.SEXCOM=="男"?"1":"2",
							afterTaxYearIn:self.message.afterTaxYearIn,//税后年收入 
							majorInTypCdNm:self.message.majorInTypCdNm,
							majorInTypCd:self.message.majorInTypCd,//主要收入来源
							age: self.AGECOM,
							prjId: self.message.projectId,
							id:self.id
						}
					}else{
						paramData={
							wrtNm: self.message.NAME,
							certNo:  self.message.ID_CARD_NO,
							mp1: self.message.TEL_PHONE,
							homeAddr: self.message.HOUSE_ADDRESS,
							workAddr: self.message.WORK_NAME,
							afterTaxYearIn:self.message.afterTaxYearIn,//税后年收入 
						    majorInTypCdNm:self.message.majorInTypCdNm,
						    majorInTypCd:self.message.majorInTypCd,//主要收入来源
							genderCd:  self.SEXCOM=="男"?"1":"2",
							age: self.AGECOM,
							prjId: self.message.projectId,
						}
					}
					var _cardType=self.message.certTypNm;
					var _cusRelation=self.message.gxNm;
					var _IS_MARRY_NM=self.message.marStsNm;
					self.totalData.carTypArray.map(function(e,i){
						if(e.label==_cardType){
							paramData.certTypCd=self.totalData.carTypArray[i].value;
						}
					});
					self.totalData.gxArray.map(function(e,i){
						if(e.label==_cusRelation){
							paramData.gxCd=self.totalData.gxArray[i].value;
						}
					});
					self.totalData.marStsArray.map(function(e,i){
						if(e.label==_IS_MARRY_NM){
							paramData.marStsCd=self.totalData.marStsArray[i].value;
						}
					});
					ajaxRequest({
						type: 'post',
						url: 'appservice/project/prjcstbscinfo/addNpWarr.do',
						param: paramData
					}, function(res) {
						summer.hideProgress();
						if (res.data.flag == 1) {
								summer.toast({msg:"保存成功"});
								summer.execScript({
									winId: "setProject",
									script: "addRight('sponsor')"
								});
								summer.closeWin()
						}
					}, function(err) {
						alert(err);
						console.log(err);
						summer.hideProgress();
					});
				},
				openPicker: function() {
					this.$refs.picker.open();
				}
			}
		})

		function complete() {
			newCreateCustom.complete();
		}
		summerready = function() {
			var projectId = summer.pageParam.projectId;
			newCreateCustom.message.projectId=projectId;
			newCreateCustom.getType(projectId);
			var clintId = summer.pageParam.clientId;
			newCreateCustom.message.CLIENT_ID=clintId;
			var item= summer.pageParam.item;
			if(item){
				newCreateCustom.message.NAME=item.wrtNm;
				newCreateCustom.message.ID_CARD_NO=item.certNo;
				newCreateCustom.message.WORK_NAME=item.workAddr;
				newCreateCustom.message.SEXCOM=(item.genderCd=="1")?"男":"女";
				newCreateCustom.message.HOUSE_ADDRESS=item.homeAddr;
				newCreateCustom.message.TEL_PHONE=item.mp1;
				newCreateCustom.AGECOM=item.age;
				newCreateCustom.id=item.id;
				newCreateCustom.isSelect=true;
				newCreateCustom.message.marStsNm=item.marStsNm;
				newCreateCustom.message.marStsCd=item.marStsCd;
				newCreateCustom.message.certTypCd=item.certTypCd;
				newCreateCustom.message.certTypNm=item.certTypNm;
				newCreateCustom.message.gxCd=item.gxCd;
				newCreateCustom.message.gxNm=item.gxNm;
				newCreateCustom.message.afterTaxYearIn=item.afterTaxYearIn;
				newCreateCustom.message.majorInTypCd=item.majorInTypCd;
				newCreateCustom.message.majorInTypCdNm=item.majorInTypCdName;
			}
			// var params = ["android.permission.ACCESS_FINE_LOCATION", "android.permission.ACCESS_COARSE_LOCATION", "android.permission.CAMERA", "android.permission.FLASHLIGHT", "android.permission.READ_EXTERNAL_STORAGE", "android.permission.READ_PHONE_STATE",
			// 	"android.permission.WRITE_EXTERNAL_STORAGE", "android.permission.ACCESS_FINE_LOCATION", "android.permission.ACCESS_COARSE_LOCATION"
			// ];
			// summer.getPermission(params, function(args) {
			// 	//alert(args); //成功返回OK
			// }, function(args) {
			// 	//alert(args); //失败返回illegal access
			// })
		}
		$(function(){
			$('body').height($('body')[0].clientHeight);
		});
	</script>
</body>

</html>
